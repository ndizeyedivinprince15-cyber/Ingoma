// packages/shared/src/constants/regions.ts

/**
 * Mapping des régions françaises métropolitaines vers leurs départements
 */
export const REGIONS: Record<string, readonly string[]> = {
  'Auvergne-Rhône-Alpes': ['01', '03', '07', '15', '26', '38', '42', '43', '63', '69', '73', '74'],
  'Bourgogne-Franche-Comté': ['21', '25', '39', '58', '70', '71', '89', '90'],
  'Bretagne': ['22', '29', '35', '56'],
  'Centre-Val de Loire': ['18', '28', '36', '37', '41', '45'],
  'Corse': ['2A', '2B'],
  'Grand Est': ['08', '10', '51', '52', '54', '55', '57', '67', '68', '88'],
  'Hauts-de-France': ['02', '59', '60', '62', '80'],
  'Île-de-France': ['75', '77', '78', '91', '92', '93', '94', '95'],
  'Normandie': ['14', '27', '50', '61', '76'],
  'Nouvelle-Aquitaine': ['16', '17', '19', '23', '24', '33', '40', '47', '64', '79', '86', '87'],
  'Occitanie': ['09', '11', '12', '30', '31', '32', '34', '46', '48', '65', '66', '81', '82'],
  'Pays de la Loire': ['44', '49', '53', '72', '85'],
  "Provence-Alpes-Côte d'Azur": ['04', '05', '06', '13', '83', '84'],
} as const;

export type Region = keyof typeof REGIONS;

/**
 * Liste des régions
 */
export const REGION_NAMES = Object.keys(REGIONS) as Region[];

/**
 * Obtenir la région à partir d'un code département
 */
export function getRegionFromDepartment(departmentCode: string): Region | null {
  for (const [region, departments] of Object.entries(REGIONS)) {
    if (departments.includes(departmentCode)) {
      return region as Region;
    }
  }
  return null;
}

/**
 * Obtenir le département à partir d'un code postal
 */
export function getDepartmentFromPostalCode(postalCode: string): string {
  if (!postalCode || postalCode.length < 2) {
    return '';
  }
  
  // Cas spécial Corse
  if (postalCode.startsWith('20')) {
    const num = parseInt(postalCode.substring(0, 3), 10);
    return num < 202 ? '2A' : '2B';
  }
  
  return postalCode.substring(0, 2);
}

/**
 * Obtenir la région à partir d'un code postal
 */
export function getRegionFromPostalCode(postalCode: string): Region | null {
  const department = getDepartmentFromPostalCode(postalCode);
  return getRegionFromDepartment(department);
}

/**
 * Vérifier si un département appartient à une région
 */
export function isDepartmentInRegion(departmentCode: string, region: Region): boolean {
  const departments = REGIONS[region];
  return departments ? departments.includes(departmentCode) : false;
}
Backend NestJS (apps/api)
